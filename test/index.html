<!DOCTYPE html>
<html>
  <head>
    <title>keyboard</title>
    <link rel="stylesheet" href="../build/build.css">
    <style>
    #game {
      width: 360px;
      height: 256px;
      border: 1px solid #aaa;
      position: relative;
    }
    .entity {
      position: absolute;
    }
    </style>
  </head>
  <body>
    <div id="game"></div>
    <script src="../build/build.js"></script>
    <script>

var map = {
  'up' : [
    [0,10,4,2]
  , [1,10,4,0]
  , [0,10,4,2]
  , [2,10,4,4]
  ]
, 'down' : [
    [3,10,4,2]
  , [4,10,4,4]
  , [3,10,4,2]
  , [5,10,4,0]
  ]
, 'right' : [
    [6,10,4,6]
  , [7,10,4,2]
  , [6,10,4,6]
  , [8,10,4,4]
  ]
, 'left' : [
    [9,10,4,6]
  , [10,10,4,4]
  , [9,10,4,6]
  , [11,10,4,4]
  ]
, 'left down' : [
    [13,10,4,8]
  , [12,10,4,6]
  , [13,10,4,8]
  , [14,10,4,4]
  ]
, 'right down' : [
    [16,10,4,4]
  , [15,10,4,4]
  , [16,10,4,4]
  , [17,10,4,2]
  ]
, 'left up' : [
    [19,10,4,8]
  , [18,10,4,4]
  , [19,10,4,8]
  , [20,10,4,6]
  ]
, 'up right' : [
    [22,10,4,4]
  , [21,10,4,2]
  , [22,10,4,4]
  , [23,10,4,4]
  ]       
}

var manager = require('entity-manager')
var game = manager()
game.el = document.getElementById('game')

var v = require('entity-vector')
var rect = require('entity-rect')
var sprite = require('entity-css-sprite')('sprite.png', map)
var loop = require('entity-loop')({ dt: 1000/60 })
var dom = require('entity-dom')(game.el)
var motion = require('entity-motion')
var position = require('entity-position')

var keyboard = require('keyboard')(document)

var move = {
  update: function (e) {
    e.setSpriteFace(e.keys)
    e.vel.set(v(inputMap[e.keys]).mul(2,2))
  }
}

var inputMap = {
   'left': [-1, 0]
,    'up': [ 0,-1]
, 'right': [ 1, 0]
,  'down': [ 0, 1]
,  'left down': [-0.7, 0.7]
,    'left up': [-0.7,-0.7]
, 'right down': [ 0.7, 0.7]
,   'up right': [ 0.7,-0.7]
}

var smooth = {
  render: function (e, a) {
    e.mesh.pos.set(v(e.prevPos).lerp(e.pos, a))
  }
}

var player = game.createEntity(
  dom
, motion
, position
, sprite
, move
, smooth
, {
    mesh: [rect, [0,0], [32,40]]
  , class: [String, 'red']
  }
)

game.use(loop)
game.use(keyboard)
game.use(position)
game.use(sprite)
game.use(move)
game.use(motion)
game.use(smooth)
game.use(dom)

game.on('init', function () {
  player.setSpriteFace('down')
})

game.on('keys', function (keys) {
  player.keys = keys
})

game.applyComponents()
game.init()
game.start()

    </script>
  </body>
</html>